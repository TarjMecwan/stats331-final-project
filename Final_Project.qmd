---
title: "Exploring Relationships Between Extreme Poverty Rates and Inflation Rates in the World"
author: "Tarj Mecwan, Bernice Lau, Rachel Hartfelder, Haley Tran"
format: 
  html:
    embed-resources: true
    code-tools: true
    code-fold: true
    toc: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

## Dependencies

To start, we need to load the `tidyverse` and `knitr` packages into RStudio.

```{r}
#| message: false

library(tidyverse)
library(knitr)
```

## Datasets

Next, we will read in our datasets!

```{r}
#| message: false

poverty <- read_csv("data/poverty.csv")
inflation <- read_csv("data/inflation.csv")
```

Let's examine the `poverty.csv` dataset.

```{r}
head(poverty) |> 
  kable()
```

Here's what the `inflation.csv` dataset looks like.

```{r}
head(inflation) |> 
  kable()
```

The poverty dataset contains information on the extreme poverty rate, where workers make less than $2.15/day, for countries over time. Each country represents one observation and each column represents one year. The inflation dataset contains information on the inflation rate for countries over time. Similar to the poverty dataset, each country represents one observation and each column represents one year. The poverty dataset contains information on the years 1800 to 2100, while the inflation dataset only contains information on the years 1961 to 2023. Both datasets contain numerous NA values.

## Data Cleaning Process

Data cleaning is a crucial step in ensuring that our analysis is based on accurate and meaningful data. Since the datasets from Gapminder contain economic indicators recorded across multiple years for different countries, we followed a structured cleaning process to prepare our data for analysis. Below, we outline the key steps and the rationale behind each decision.

#### 1. Filtering Overlapping Years

The original datasets contained economic data spanning different time periods, with some variables recorded in years that were not present in the other dataset. To maintain consistency, we filtered both datasets to include only the overlapping years, **1961 to 2023**. This step ensures that we are analyzing the relationship between extreme poverty rates and inflation rates over a common time period without introducing missing values due to mismatched years.

```{r}
# Filter the datasets to include only the overlapping years (1961 to 2023)
inflation_filtered <- inflation |>
  select(country, `1961`:`2023`)

poverty_filtered <- poverty |>
  select(country, `1961`:`2023`)

```

#### 2. Reshaping the Data: Pivoting Longer

The datasets were structured in a wide format, where each year was a separate column. For ease of analysis and visualization, we transformed them into a long format by pivoting the year columns into a single `year` variable. This conversion was necessary to perform operations like merging datasets and running regression models. We also ensured that the `year` column was treated as a numeric variable rather than a character string, enabling proper chronological analysis.

```{r}
# 1.2 Pivoting Longer
# Pivot the year columns to a single column in both datasets
inflation_long <- inflation_filtered |>
  pivot_longer(cols = `1961`:`2023`, 
               names_to = "year", 
               values_to = "inflation_rate") |>
  mutate(year = as.numeric(year))

poverty_long <- poverty_filtered |>
  pivot_longer(cols = `1961`:`2023`, 
               names_to = "year", 
               values_to = "poverty_rate") |>
  mutate(year = as.numeric(year))

```

#### 3. Merging the Datasets

After reshaping, we joined the two datasets on the common columns: `country` and `year`. Given that some countries may have missing data for either variable, we chose an inner join to retain only the observations that exist in both datasets. This approach minimizes the risk of bias in our analysis by ensuring that each `country-year` pair has both poverty and inflation data available.

```{r}
# 1.3 Joining Datasets
# Join the datasets on country and year
poverty_inflation_data <- inflation_long |>
  inner_join(poverty_long, by = c("country", "year"))

```

#### 4. Handling Missing Values

Economic data often contains missing values due to reporting inconsistencies or gaps in data collection. To address this, we dropped rows with missing values after merging the datasets. While other imputation techniques (such as mean or median substitution) could have been used, we opted for deletion to maintain the integrity of our statistical analysis and avoid introducing artificial patterns.

```{r}
# Handle missing values
poverty_inflation_data <- poverty_inflation_data |>
  drop_na()

```

#### 5. Handling Variable Type Conversions

- Convert inflation_rate from character to numeric type
**TO DO** (Tarj)

```{r}
#| warning: false
#| message: false

# Replace non-standard minus signs with the standard minus sign
poverty_inflation_data <- poverty_inflation_data |>
  mutate(inflation_rate = gsub("\u2212", "-", inflation_rate)) 

# Handle 'k' suffix for thousands and convert to numeric
poverty_inflation_data <- poverty_inflation_data |>
  mutate(inflation_rate = ifelse(
    grepl("k", inflation_rate, ignore.case = TRUE),
    as.numeric(gsub("k", "", inflation_rate, ignore.case = TRUE)) * 1000,
    as.numeric(inflation_rate)))
```

#### 6. Final Dataset Verification

After completing these steps, we inspected the cleaned dataset to confirm that:

-   All countries and years were correctly aligned.

-   No extraneous variables remained.

-   The dataset was free of missing values.

```{r}
head(poverty_inflation_data) |>
  kable()
```

Now, we can save the cleaned dataset into a CSV!

```{r}
# Save the cleaned data frame to a CSV
write_csv(poverty_inflation_data, "data/poverty_inflation_data.csv")
```

The joined dataset contains 10,163 observations and 4 variables: `country` of type character, `year` of type numeric, `inflation_rate` of type numeric, and `poverty_rate` of type numeric. Each `country-year` pair represents one observation. The dataset contains the annual inflation and extreme poverty rates for each country from 1961 to 2023.


## Hypothesis

We hypothesize that there will be a nonlinear relationship between inflation rates and poverty rates in the world. Intuitively, frequent fluctuations in inflation rates will be associated with higher poverty rates, as economic instability disproportionately affects people of lower incomes. Additionally, we hypothesize there will be regional or country-specific patterns because economic structures, government policies, and external factors such as tariffs and diplomatic conflict will effect the relationship between inflation and poverty differs across global regions.
